# Стартер для синхронизации справочников НСИ

## Общая информация

Синхронизатор предоставляет API для запуска копирования справочников НСИ.
Клиент либо сам определяет момент запуска процесса синхронизации, либо включает автоматическое обновление на основе событий публикации справочника (только для RDM).

## Требования к клиентскому приложению

Клиентское приложение:
1) должно быть реализовано на java 14, spring-boot 2 и платформе n2o-platform версии 4.4.0;
2) должно использовать библиотеку Liquibase для автоматического обновления базы данных;
3) должно использовать фреймворк для автоматизации сборки проектов maven3.

## Информация для разработчика

### Подключение

1. Добавить в pom зависимость.
    ```xml
    <dependency>
        <groupId>ru.i-novus.ms.rdm</groupId>
        <artifactId>rdm-sync-spring-boot-starter</artifactId>
        <version>${rdm.sync.version}</version>
    </dependency>
    ```
2. [Настроить маппинг](../#Настройка-маппинга) и создать таблицы для справочников,
   либо воспользоваться [автосозданием](../#Создание-таблиц-клиента-в-автоматическом-режиме).

3. Указать адрес API НСИ в `rdm.client.sync.url`

4. Запустить клиентское приложение.

**Важно:**
Liquibase в rdm-sync запускается ПОСЛЕ общего Liquibase, сконфигурированного по умолчанию.
Поэтому если нужно добавить скрипт, который производит изменения в схеме rdm_sync,
необходимо добавить его в каталог `/rdm-sync-db/changelog`.

После запуска у клиентского приложения будет доступно API:
1. `POST {CLIENT_SERVICE_URL}/rdm/update` -- обновление всех справочников, которые ведутся в системе клиента.
2. `POST {CLIENT_SERVICE_URL}/rdm/update?refbookCode=A001` -- обновление конкретного справочника,
   где A001 -- код справочника.

Для того чтобы отключить синхронизацию полностью, надо указать настройку
- `rdm_sync.enabled=false` (по умолчанию -- включено).
